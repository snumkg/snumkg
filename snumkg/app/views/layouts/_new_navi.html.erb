<% content_for :head do %>
  <%= javascript_include_tag :user %>
  <%= javascript_include_tag "jquery.color" %>
<% end %>


<style>
  #loading-image {
    z-index: 3;
    position: absolute;
    left: 35px;
    top: 10px;
    display: none;
    }

    #alarm_list_box {
      position: relative;
    }
</style>

<div id="nav_container">
  <ul id="my_info">
    <li>
    <%= link_to "홈으로", root_path %>
    </li>
    <% if current_user %>
      <% if current_user.admin? %>
        <li>
        <%= link_to "관리자페이지", admin_path %>
        </li>
      <% end %>
      <li>
      <%= link_to "쪽지[#{current_user.message_count}]", messages_path(type: "receive") %>
      </li>
      <li>
      <%= link_to "알림[#{current_user.new_alarm_count}]",user_alarms_path, id: "alarm_link", :remote => true %>
      <div id="alarm_list_box">
        <div id="loading-image">
          <%= image_tag "loading.gif", size: "30x30" %>
        </div>
        <ul id="alarm_list">
        </ul>
      </div>
      </li>
      <li>
      <%= image_tag picture_path(type: "profile", id: current_user.id, :thumb => "thumb"), :size => "25x25" %><%= link_to current_user.nickname, profile_path(current_user), class: "up" %>
      </li>
      <li id="search_box">
      <%= form_tag search_path, method: :get, remote: true do %>
        <%= text_field_tag :search_name, nil, class: "span2", :placeholder => "이름을 입력하세요.." %><%= submit_tag "검색", class: "btn-mini", id: "search_name_submit" %>
        <div id="search_list"></div>
      <% end %>
      </li>
      <li><%= link_to "로그아웃", signout_path %></li>
    <% else %>
      <li>
      <ul>
        <%= link_to "로그인", "#", class: "login" %>
        <li class="login_box">
        <%= render 'shared/login_box' %>
        </li>
      </ul>
      </li>
      <li><a href="#myModal" data-toggle="modal">회원가입</a></li>
    <% end %>

  </ul>
  <div id="logo_box">LOGO</div>
  <div id="menu">
    <ul>
      <li>
      <%= link_to "누구나", group_path(1) %>
      </li>
      <li>
      <%= link_to "학번별 공간", "#" %>
      <ul class="sub_menu">
        <li>
        <%= link_to "모아보기", '/all' %>
        </li>
        <% for group in @groups %>
          <% if group.group_type == "학번" %>
            <li>
            <%= link_to group.name, group_path(group) %>
            </li>
          <% end %>
        <% end %>
      </ul>
      </li>
      <li>
      <%= link_to "소꼬지", "#" %>
      </li>
      <li>
      <%= link_to "매일매일", "#" %>
      </li>
      <li>
			<%= link_to "채팅", "#", :onclick => "window.open('/chat','chat','directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=820,height=620');" %>
      </li>
    </ul>
  </div>
</div>


<script>
  //alarm ajax

  $(function(){

    /*
    $("#search_name_submit").click(function(){
      
      var val = $("#search_name").attr("value");

      $.ajax({
        url: '/search.json?name="'+val+'"',
        success: function(data){
          console.log(data);
        }

      });

      
    });
    */



    $("#alarm_link").click(function(){

      $.ajax({
        url: '/alarms',
        beforeSend: function(){
          $("#alarm_list").html("").show();
          $("#loading-image").show();
        },
        success: function(data){
          $("#loading-image").hide();

          $("#alarm_list").append($(data).find("#alarm_list_ajax").html()).show();
          $("#alarm_list li.new").css("background", "#fee");

        }
      });
      
    });
  });
</script>
